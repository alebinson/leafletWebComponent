<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
  <title>Stencil Component Starter</title>

  <script type="module" src="/build/leafletwc.esm.js"></script>
  <script nomodule src="/build/leafletwc.js"></script>

  </head>
  <style>
    .draw-btn{
      background-color: rgba(51, 181, 229, 0.4);
      border-radius: 9px;
      width: 80px;
      height: 27px;
    }
  </style>
<body>

  <my-component first="Stencil" last="'Don't call me a framework' JS"></my-component>

  <hr>

  <button class="draw-btn" id="drawPolyline">Polyline</button>
  <button class="draw-btn" id="drawPolygon">Polygon</button>
  <button class="draw-btn" id="drawRectangle">Rectangle</button>
  <button class="draw-btn" id="drawCircle">Circle</button>
  <div  style="width: 100%;height: 600px;"> 
    <l-map 
      id="leafletMap"
      tile-layer-url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" 
      icon-url1="https://zoranlj.000webhostapp.com/modities-map/Modus-Mark-White.png"
      icon-url="assets/images/marker-icon.png" 
      current-location="[0,0]" 
      current-location-icon-url="https://zoranlj.000webhostapp.com/modities-map/Modus-Mark-Black.png" 
      center="[51.505, -0.04]" 
      zoom="8" 
      min-zoom="2" 
      max-zoom="16" 
      show-draw-control="false"
      class="hydrated">
    </l-map>
  </div>

</body>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    var map_wc = document.getElementById('leafletMap');

    setTimeout(()=>{
        map_wc.locations=[[51.505, -0.04],[51.615, -0.04]];
    },2000);
    map_wc.addEventListener('message',(ev) => {
      console.log('EVENT FROM LEAFLET-WEBCOMPONENT',ev.detail);
    });

    //GEOJSON INIT
    const freeBus = {
      "type": "FeatureCollection",
      "features": [
          {
              "type": "Feature",
              "geometry": {
                  "type": "LineString",
                  "coordinates": [
                      [-105.00341892242432, 39.75383843460583],
                      [-105.0008225440979, 39.751891803969535]
                  ]
              },
              "properties": {
                  "popupContent": "This is a free bus line that will take you across downtown.",
                  "underConstruction": false
              },
              "id": 1
          },
          {
              "type": "Feature",
              "geometry": {
                  "type": "LineString",
                  "coordinates": [
                      [-105.0008225440979, 39.751891803969535],
                      [-104.99820470809937, 39.74979664004068]
                  ]
              },
              "properties": {
                  "popupContent": "This is a free bus line that will take you across downtown.",
                  "underConstruction": true
              },
              "id": 2
          },
          {
              "type": "Feature",
              "geometry": {
                  "type": "LineString",
                  "coordinates": [
                      [-104.99820470809937, 39.74979664004068],
                      [-104.98689651489258, 39.741052354709055]
                  ]
              },
              "properties": {
                  "popupContent": "This is a free bus line that will take you across downtown.",
                  "underConstruction": false
              },
              "id": 3
          }
      ]
    };
  
    const lightRailStop = {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {
                    "popupContent": "18th & California Light Rail Stop"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-104.98999178409576, 39.74683938093904]
                }
            },{
                "type": "Feature",
                "properties": {
                    "popupContent": "20th & Welton Light Rail Stop"
                },
                "geometry": {
                    "type": "Point",
                    "coordinates": [-104.98689115047453, 39.747924136466565]
                }
            }
        ]
    };
  
    const bicycleRental = {
        "type": "FeatureCollection",
        "features": [
            {
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -104.9998241,
                        39.7471494
                    ]
                },
                "type": "Feature",
                "properties": {
                    "popupContent": "This is a B-Cycle Station. Come pick up a bike and pay by the hour. What a deal!",
                    "presentedInLayer": {
                      "type": "circle",
                      "style": {
                        "radius": 8,
                        "fillColor": "#ff7800",
                        "color": "#000",
                        "weight": 1,
                        "opacity": 1,
                        "fillOpacity": 0.8
                      }
                    }
                },
                "id": 51
            },
            {
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -104.9983545,
                        39.7502833
                    ]
                },
                "type": "Feature",
                "properties": {
                    "popupContent": "This is a B-Cycle Station. Come pick up a bike and pay by the hour. What a deal!"
                },
                "id": 52
            },
            {
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -104.9963919,
                        39.7444271
                    ]
                },
                "type": "Feature",
                "properties": {
                    "popupContent": "This is a B-Cycle Station. Come pick up a bike and pay by the hour. What a deal!"
                },
                "id": 54
            },
            {
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -104.9960754,
                        39.7498956
                    ]
                },
                "type": "Feature",
                "properties": {
                    "popupContent": "This is a B-Cycle Station. Come pick up a bike and pay by the hour. What a deal!"
                },
                "id": 55
            },
            {
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -104.9933717,
                        39.7477264
                    ]
                },
                "type": "Feature",
                "properties": {
                    "popupContent": "This is a B-Cycle Station. Come pick up a bike and pay by the hour. What a deal!"
                },
                "id": 57
            },
            {
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -104.9913392,
                        39.7432392
                    ]
                },
                "type": "Feature",
                "properties": {
                    "popupContent": "This is a B-Cycle Station. Come pick up a bike and pay by the hour. What a deal!"
                },
                "id": 58
            },
            {
                "geometry": {
                    "type": "Point",
                    "coordinates": [
                        -104.9788452,
                        39.6933755
                    ]
                },
                "type": "Feature",
                "properties": {
                    "popupContent": "This is a B-Cycle Station. Come pick up a bike and pay by the hour. What a deal!"
                },
                "id": 74
            }
        ]
    };
  
    const campus = {
        "type": "Feature",
        "properties": {
            "popupContent": "This is the Auraria West Campus",
            "style": {
                weight: 2,
                color: "#999",
                opacity: 1,
                fillColor: "#B0DE5C",
                fillOpacity: 0.8
            }
        },
        "geometry": {
            "type": "MultiPolygon",
            "coordinates": [
                [
                    [
                        [-105.00432014465332, 39.74732195489861],
                        [-105.00715255737305, 39.74620006835170],
                        [-105.00921249389647, 39.74468219277038],
                        [-105.01067161560059, 39.74362625960105],
                        [-105.01195907592773, 39.74290029616054],
                        [-105.00989913940431, 39.74078835902781],
                        [-105.00758171081543, 39.74059036160317],
                        [-105.00346183776855, 39.74059036160317],
                        [-105.00097274780272, 39.74059036160317],
                        [-105.00062942504881, 39.74072235994946],
                        [-105.00020027160645, 39.74191033368865],
                        [-105.00071525573731, 39.74276830198601],
                        [-105.00097274780272, 39.74369225589818],
                        [-105.00097274780272, 39.74461619742136],
                        [-105.00123023986816, 39.74534214278395],
                        [-105.00183105468751, 39.74613407445653],
                        [-105.00432014465332, 39.74732195489861]
                    ],[
                        [-105.00361204147337, 39.74354376414072],
                        [-105.00301122665405, 39.74278480127163],
                        [-105.00221729278564, 39.74316428375108],
                        [-105.00283956527711, 39.74390674342741],
                        [-105.00361204147337, 39.74354376414072]
                    ]
                ],[
                    [
                        [-105.00942707061768, 39.73989736613708],
                        [-105.00942707061768, 39.73910536278566],
                        [-105.00685214996338, 39.73923736397631],
                        [-105.00384807586671, 39.73910536278566],
                        [-105.00174522399902, 39.73903936209552],
                        [-105.00041484832764, 39.73910536278566],
                        [-105.00041484832764, 39.73979836621592],
                        [-105.00535011291504, 39.73986436617916],
                        [-105.00942707061768, 39.73989736613708]
                    ]
                ]
            ]
        }
    };
  
    const coorsField = {
        "type": "Feature",
        "properties": {
            "popupContent": "Coors Field",
            "presentedInLayer": {
              "type": "marker",
              "iconUrl": "https://leafletjs.com/examples/geojson/baseball-marker.png"
            }
        },
        "geometry": {
            "type": "Point",
            "coordinates": [-104.99404191970824, 39.756213909328125]
        }
    };

    map_wc.geoJsonData=[bicycleRental, campus, freeBus, coorsField];

    //HEATMAP INIT
    const heatPoints = [
      [51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],[51.505, -0.04],
      [51.509, -0.04],
      [51.516, -0.04],
      [51.525, -0.04],
      [51.531, -0.04],
      [51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],[51.541, -0.04],
      [51.551, -0.04],
      [51.561, -0.04],
      [51.571, -0.04],
      [51.581, -0.04],
      [51.615, -0.04],

      [-37.8839, 175.3745188667],
      [-37.8869090667, 175.3657417333],
      [-37.8894207167, 175.4015351167],
      [-37.8927369333, 175.4087452333],
      [-37.90585105, 175.4453463833],
      [-37.9064188833, 175.4441556833],
      [-37.90584715, 175.4463564333],
      [-37.9033391333, 175.4244005667],
      [-37.9061991333, 175.4492620333],
      [-37.9058955167, 175.4445613167],
      [-37.88888045, 175.39146475],
      [-37.8950811333, 175.41079175],
      [-37.88909235, 175.3922956333],
      [-37.8889259667, 175.3938591667],
      [-37.8876576333, 175.3859563833],
      [-37.89027155, 175.3973178833],
      [-37.8864473667, 175.3806136833],
      [-37.9000262833, 175.4183242167],
      [-37.90036495, 175.4189457],
      [-37.9000976833, 175.4197312167],
      [-37.90239975, 175.42371165],
      [-37.9043379667, 175.42430325],
      [-37.9026441, 175.4231055167],
      [-37.8883536333, 175.3888573833],
      [-37.9029948833, 175.4237386167],
      [-37.89824135, 175.4150421667],
      [-37.8976067833, 175.41510265],
      [-37.9023491333, 175.4225495],
      [-37.8856157167, 175.3775632833],
      [-37.8963032667, 175.4132068],
      [-37.8922813667, 175.4073402333898]
    ];

    map_wc.heatMapData = heatPoints;

    //BBUULES INIT
    // Pass Leaflet.bubble  data as GeoJSON object and amount property to visualize
    const bubblesData = {
        options: {
            property: "population",
            legend: false,
            max_radius : 40,
            tooltip : true,
            scale: ['yellow', '008ae5']
        },
        data: {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-118.244, 34.052]
                    },
                    "properties": {
                        "city": "Los Angeles",
                        "population": 3884307
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-117.157, 32.715]
                    },
                    "properties": {
                        "city": "San Diego",
                        "population": 1307402
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-121.895, 37.339]
                    },
                    "properties": {
                        "city": "San Jose",
                        "population": 945942
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-122.419, 37.775]
                    },
                    "properties": {
                        "city": "San Francisco",
                        "population": 805235
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-119.772, 36.748]
                    },
                    "properties": {
                        "city": "Fresno",
                        "population": 494665
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-121.494, 38.582]
                    },
                    "properties": {
                        "city": "Sacramento",
                        "population": 466488
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-118.189, 33.767]
                    },
                    "properties": {
                        "city": "Long Beach",
                        "population": 462257
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-122.271, 37.804]
                    },
                    "properties": {
                        "city": "Oakland",
                        "population": 390724
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-119.019, 35.373]
                    },
                    "properties": {
                        "city": "Bakersfield",
                        "population": 347483
                    }
                },
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-117.915, 33.835]
                    },
                    "properties": {
                        "city": "Anaheim",
                        "population": 336265
                    }
                }
            ]
        }
    }

    map_wc.bubbleLayerData = bubblesData;
    
    (() => {
      var drawActions = {
        drawPolygon: 'polygonDrawer',
        drawPolyline: 'polylineDrawer',
        drawRectangle: 'rectangleDrawer',
        drawCircle: 'circleDrawer'
      }

      for (const action in drawActions) {
        var btn = document.getElementById(action);
        btn.addEventListener('click',(ev) => {
          map_wc.drawers[drawActions[action]].enable();
        });

        // console.log(`${action}: ${drawActions[action]}`);
      }
    })();

    // // ******** Observe on changes when one(className) DOM property is changed
    // function callback(mutationList, props) {
    //   mutationList.forEach(function(mutation) {
    //     switch(mutation.type) {
    //       case "attributes":
    //         console.log("Attribute name " + mutation.attributeName +
    //             " changed to " + mutation.target[mutation.attributeName] +
    //             " (was " + mutation.oldValue + ")");
             
    //         props.forEach(function(prop) {
    //           console.log(prop + ' is:', mutation.target[prop]);
    //         });
    //         break;
    //     }
    //   });
    // }

    // const observer = new MutationObserver((mutationList)=>callback(mutationList,['center','zoom']));

    // observer.observe(map_wc, {
    //   attributes: true,
    //   attributeOldValue: true
    // });

    console.log('DOM fully loaded and parsed');
  });
</script>
<!-- <script src="../node_modules/esri-leaflet/dist/esri-leaflet"></script> -->
</html>
